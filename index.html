<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INCI | Admin İdarəetmə</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --blue: #2563eb; --red: #ef4444; --green: #10b981; --dark: #121212; --light: #f8fafc; --orange: #f59e0b; }
        body { font-family: 'Inter', sans-serif; background: var(--light); margin: 0; padding: 0; color: var(--dark); }
        
        .admin-header { background: white; padding: 15px 25px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #e2e8f0; position: sticky; top: 0; z-index: 100; }
        .wrapper { max-width: 1200px; margin: 25px auto; padding: 0 20px; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 20px; border-radius: 16px; border: 1px solid #e2e8f0; display: flex; align-items: center; gap: 15px; }
        .stat-icon { width: 45px; height: 45px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; }

        .main-grid { display: grid; grid-template-columns: 1fr 1.5fr; gap: 30px; }
        @media (max-width: 900px) { .main-grid { grid-template-columns: 1fr; } }

        .card { background: white; padding: 25px; border-radius: 20px; border: 1px solid #e2e8f0; margin-bottom: 25px; }
        h3 { margin-top: 0; font-size: 18px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }

        input, select, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #e2e8f0; border-radius: 10px; box-sizing: border-box; outline: none; font-family: inherit; }
        .btn-add { background: var(--dark); color: white; border: none; padding: 14px; border-radius: 10px; cursor: pointer; font-weight: 600; width: 100%; transition: 0.3s; }
        .btn-add:hover { background: #333; }

        .list-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #f1f5f9; }
        .item-img { width: 50px; height: 50px; border-radius: 10px; object-fit: cover; }

        .order-box { background: #fff; border: 1px solid #e2e8f0; border-radius: 18px; padding: 20px; margin-bottom: 20px; position: relative; transition: 0.3s; }
        .order-box:hover { border-color: var(--blue); box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        
        .status-select { width: auto; font-size: 12px; padding: 8px; margin: 0; border-color: var(--blue); font-weight: 600; cursor: pointer; }
        .badge-stock { font-size: 10px; padding: 2px 6px; border-radius: 5px; font-weight: bold; }
        .in-stock { background: #dcfce7; color: #166534; }
        .out-stock { background: #fee2e2; color: #991b1b; }
    </style>
</head>
<body>

<div class="admin-header">
    <h2 style="margin:0; letter-spacing: 2px;">INCI <span style="font-weight: 300; font-size: 14px;">ADMIN</span></h2>
    <div id="liveClock" style="font-weight: 600; color: var(--blue);">00:00:00</div>
</div>

<div class="wrapper">
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon" style="background: #e0f2fe; color: var(--blue);"><i class="fas fa-shopping-bag"></i></div>
            <div><small>Cəmi Sifarişlər</small><div id="totalOrders" style="font-size: 20px; font-weight: 800;">0</div></div>
        </div>
        <div class="stat-card">
            <div class="stat-icon" style="background: #dcfce7; color: var(--green);"><i class="fas fa-box"></i></div>
            <div><small>Məhsul Sayı</small><div id="totalProducts" style="font-size: 20px; font-weight: 800;">0</div></div>
        </div>
    </div>

    <div class="main-grid">
        <div class="side">
            <div class="card">
                <h3><i class="fas fa-plus-circle"></i> Yeni Məhsul</h3>
                <input id="pName" placeholder="Məhsul adı">
                <input id="pPrice" type="number" placeholder="Qiymət (AZN)">
                <input id="pImg" placeholder="Şəkil Linki (URL)">
                <textarea id="pDesc" placeholder="Məhsul haqqında məlumat"></textarea>
                <div style="display:flex; gap:10px;">
                    <input id="pDays" type="number" placeholder="Çatdırılma (gün)" style="flex:1;">
                    <select id="pCat" style="flex:2;">
                        <option value="Geyim">Geyim</option>
                        <option value="Aksesuar">Aksesuar</option>
                        <option value="Kolleksiya">Kolleksiya</option>
                    </select>
                </div>
                <button class="btn-add" onclick="addProduct()">Sistemə Əlavə Et</button>
            </div>

            <div class="card">
                <h3><i class="fas fa-list"></i> Stok və Məhsullar</h3>
                <div id="pListAdmin">Yüklənir...</div>
            </div>
        </div>

        <div class="side">
            <div class="card">
                <h3 style="color: var(--blue);"><i class="fas fa-bolt"></i> Aktiv Sifarişlər</h3>
                <div id="orderListAdmin">Sifariş gözlənilir...</div>
            </div>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script>
    // Firebase tənzimləmələri
    firebase.initializeApp({ databaseURL: "https://azad042-65afa-default-rtdb.firebaseio.com" });
    const db = firebase.database();

    // Canlı saat
    setInterval(() => { document.getElementById("liveClock").innerText = new Date().toLocaleTimeString(); }, 1000);

    // Məhsul Əlavə Etmə
    function addProduct() {
        const name = document.getElementById("pName").value, 
              price = document.getElementById("pPrice").value, 
              img = document.getElementById("pImg").value, 
              desc = document.getElementById("pDesc").value,
              days = document.getElementById("pDays").value, 
              cat = document.getElementById("pCat").value;
        
        if(!name || !price || !img) return alert("Ad, qiymət və şəkil mütləqdir!");

        db.ref('products').push({ 
            name, 
            price: parseFloat(price), 
            img, 
            description: desc, 
            deliveryDays: days || 1, 
            category: cat, 
            inStock: true 
        }).then(() => {
            alert("Məhsul uğurla əlavə edildi!");
            ["pName", "pPrice", "pImg", "pDesc", "pDays"].forEach(id => document.getElementById(id).value = "");
        });
    }

    // Məhsulları Dinamik Yüklə və Stok İdarə Et
    db.ref('products').on('value', snap => {
        let html = "", count = 0;
        snap.forEach(c => {
            let p = c.val(); count++; 
            let isOut = p.inStock === false;
            html += `<div class="list-item" style="opacity: ${isOut ? '0.6' : '1'}">
                <div style="display:flex; align-items:center; gap:12px;">
                    <img src="${p.img}" class="item-img">
                    <div>
                        <div style="font-size:13px; font-weight:700;">${p.name}</div>
                        <small>${p.price} AZN</small> 
                        <span class="badge-stock ${isOut ? 'out-stock' : 'in-stock'}">${isOut ? 'Bitib' : 'Stokda'}</span>
                    </div>
                </div>
                <div style="display:flex; gap:12px;">
                    <button onclick="toggleStock('${c.key}', ${!isOut})" title="Stoku dəyiş" style="border:none; background:none; cursor:pointer; color:var(--blue); font-size:18px;">
                        <i class="fas ${isOut ? 'fa-eye-slash' : 'fa-eye'}"></i>
                    </button>
                    <button onclick="if(confirm('Silinsin?')) db.ref('products/${c.key}').remove()" style="border:none; background:none; cursor:pointer; color:var(--red); font-size:18px;">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>`;
        });
        document.getElementById("pListAdmin").innerHTML = html || "Məhsul tapılmadı.";
        document.getElementById("totalProducts").innerText = count;
    });

    function toggleStock(id, status) { db.ref('products/' + id).update({ inStock: !status }); }

    // Sifarişləri Yüklə və Müştəri Panelini Yenilə
    db.ref('orders').on('value', snap => {
        let html = "", count = 0;
        snap.forEach(c => {
            let o = c.val(); count++;
            let orderImgs = o.itemImages ? o.itemImages.map(img => `<img src="${img}" style="width:40px; height:40px; border-radius:8px; object-fit:cover; border:1px solid #eee;">`).join('') : '';
            
            html = `
            <div class="order-box">
                <div style="display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:10px;">
                    <div>
                        <span style="font-weight:900; color:var(--blue);">#${o.id}</span>
                        <div style="font-size:14px; margin-top:5px; font-weight:700;">${o.customer}</div>
                    </div>
                    <div style="text-align:right;">
                        <div style="font-weight:800; color:var(--green);">${o.total}</div>
                        <small style="font-size:10px; color:#888;">${o.orderTime || ''}</small>
                    </div>
                </div>
                
                <div style="background:#f1f5f9; padding:10px; border-radius:10px; margin:10px 0; font-size:12px; line-height:1.6;">
                    <div><i class="fas fa-phone"></i> <b>${o.phone}</b></div>
                    <div><i class="fas fa-map-marker-alt"></i> ${o.address}</div>
                </div>

                <div style="display:flex; gap:5px; margin:10px 0; overflow-x:auto;">${orderImgs}</div>

                <div style="display:flex; justify-content:space-between; align-items:center; border-top:1px solid #eee; padding-top:15px; margin-top:10px;">
                    <select class="status-select" onchange="updateStatus('${c.key}', this.value)">
                        <option value="Sifariş verildi" ${o.status=='Sifariş verildi'?'selected':''}>Sifariş verildi</option>
                        <option value="Hazırlanır" ${o.status=='Hazırlanır'?'selected':''}>Hazırlanır</option>
                        <option value="Paketləmə" ${o.status=='Paketləmə'?'selected':''}>Paketləmə</option>
                        <option value="Yola düşüb" ${o.status=='Yola düşüb'?'selected':''}>Yola düşüb</option>
                        <option value="Təhvil verildi" ${o.status=='Təhvil verildi'?'selected':''}>Təhvil verildi</option>
                    </select>
                    <button onclick="if(confirm('Sifarişi silmək istədiyinizə əminsiniz?')) db.ref('orders/${c.key}').remove()" style="color:var(--red); border:none; background:none; font-size:12px; cursor:pointer; font-weight:600;">Sifarişi Sil</button>
                </div>
            </div>` + html;
        });
        document.getElementById("orderListAdmin").innerHTML = html || "Sifariş yoxdur.";
        document.getElementById("totalOrders").innerText = count;
    });

    // Sifariş statusu dəyişəndə vaxtı da qeyd et (Müştəri paneli üçün)
    function updateStatus(key, status) {
        let updates = { status: status };
        const now = new Date();
        const timeStr = now.getHours().toString().padStart(2,'0') + ":" + now.getMinutes().toString().padStart(2,'0');

        if(status === "Hazırlanır") updates.time_prep = timeStr;
        if(status === "Paketləmə") updates.time_pack = timeStr;
        if(status === "Yola düşüb") updates.time_ship = timeStr;
        if(status === "Təhvil verildi") updates.time_done = timeStr;

        db.ref('orders/' + key).update(updates);
    }
</script>
</body>
</html>
