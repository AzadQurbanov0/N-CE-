<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Para √áuvalƒ± v…ô Google Giri≈ü</title>
<style>
:root{
  --bg1:#0f0c29;
  --bg2:#302b63;
  --bg3:#24243e;
  --card:rgba(255,255,255,0.06);
  --glass:rgba(255,255,255,0.12);
  --text:#f8fafc;
  --accent:#22c55e;
}
*{box-sizing:border-box;margin:0;padding:0;}
html,body{height:100%;}
body{
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,'Helvetica Neue',Arial,'Apple Color Emoji','Segoe UI Emoji';
  color:var(--text);
  background:linear-gradient(135deg,var(--bg1),var(--bg2) 50%,var(--bg3));
  display:grid;
  place-items:center;
  overflow:hidden;
  opacity:0;
  animation:fadeIn 1s forwards;
}
@keyframes fadeIn{0%{opacity:0;}100%{opacity:1;}}
.wrap{display:grid;place-items:center;gap:12px;text-align:center;padding:20px;opacity:0; transform:translateY(-20px); animation:slideDown 0.8s forwards 0.3s;}
@keyframes slideDown{0%{opacity:0; transform:translateY(-20px);}100%{opacity:1; transform:translateY(0);}}

.user-info{font-size:1rem;font-weight:600;opacity:.9;margin-bottom:6px;}
.card{
position:relative;
width:min(60vw,320px);
aspect-ratio:1/1;
display:grid;
place-items:center;
background: radial-gradient(60% 60% at 50% 30%,var(--glass),transparent 70%),var(--card);
border:1px solid rgba(255,255,255,0.14);
border-radius:24px;
box-shadow:0 15px 40px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.08);
backdrop-filter:blur(6px);
}
.bag{font-size:clamp(5rem,18vw,12rem);filter:drop-shadow(0 8px 15px rgba(0,0,0,0.35));user-select:none;animation:float 5s ease-in-out infinite;}
.balance{margin-top:10px;display:grid;place-items:center;font-weight:700;letter-spacing:1px;text-shadow:0 2px 5px rgba(0,0,0,0.5);}
.balance .symbol{font-size:clamp(1rem,2.5vw,1.5rem);opacity:.9;margin-right:4px;}
.balance .value{font-size:clamp(1.5rem,5vw,2.5rem);line-height:1;}
.google-btn{
margin-top:14px;
padding:8px 16px;
font-size:0.95rem;
background:#4285F4;
color:white;
border:none;
border-radius:8px;
cursor:pointer;
display:flex;
align-items:center;
gap:6px;
font-weight:600;
}
.glow{position:absolute;inset:-30%;pointer-events:none;background:radial-gradient(40% 35% at 50% 10%, rgba(34,197,94,.25), transparent 60%),radial-gradient(30% 30% at 80% 70%, rgba(99,102,241,.18), transparent 60%);filter:blur(30px);}
#confettiContainer{position:fixed;top:0;left:0;width:100%;height:0;pointer-events:none;overflow:visible;}
@keyframes float{0%,100%{transform:translateY(0);}50%{transform:translateY(-5px);}}

/* Buttons */
.action-buttons button {
  position: fixed;
  right: 20px;
  padding: 10px 20px;
  font-size: 1rem;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
}
#payBtn { top: 20px; background: #22c55e; }
#cekBtn { top: 64px; background: #2563eb; }
#pulCekBtn { top: 108px; background: #f59e0b; }

/* Notification Icon */
#notification-bell {
  position: fixed;
  top: 20px;
  left: 20px;
  font-size: 28px;
  cursor: pointer;
  user-select: none;
  z-index: 10000;
}
#notification-badge {
  position: absolute;
  top: -5px;
  right: -8px;
  background: #ef4444;
  color: white;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  display: none;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  font-weight: bold;
}

/* Modals */
.modalOverlay{
  position:fixed; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.6);
  display:flex; align-items:center; justify-content:center;
  z-index:9999; display:none;
}
.modalContent{
  background:linear-gradient(135deg,var(--bg1),var(--bg2));
  padding:20px; border-radius:12px; text-align:center; color:white;
  width: min(90vw, 350px);
}
.modalContent h3 { margin-bottom: 15px; font-weight: 600; }
.modalContent button { margin-top:12px; padding:8px 16px; font-size:1rem; border:none; border-radius:8px; cursor:pointer; }
.modalContent input {
  display: block; width: 95%; margin: 10px auto; padding: 10px;
  border-radius: 5px; border: 1px solid rgba(255,255,255,0.2);
  background: rgba(255,255,255,0.1); color: white; font-size: 1rem;
}
.modalContent input::placeholder { color: #ccc; opacity: 0.7; }
#withdrawBtn { background: #eab308; }
#closePulCekModal, #closeNotificationsModal { background: #ef4444; }

/* Notification History Modal */
#notifications-list {
  max-height: 300px; overflow-y: auto; text-align: left;
  margin-top: 15px; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 8px;
}
.notification-item {
  background: rgba(255,255,255,0.05); padding: 8px; border-radius: 4px; margin-bottom: 8px; font-size: 0.9rem;
}
.notification-item .date { font-size: 0.75rem; opacity: 0.7; }
.notification-item .status-pending { color: #f59e0b; font-weight: bold; }

</style>
</head>
<body>

<div id="notification-bell">
  <span>üîî</span>
  <div id="notification-badge">1</div>
</div>

<div class="wrap">
  <div id="userInfo" class="user-info"></div>
  <div class="card">
    <div class="glow"></div>
    <div class="bag">üí∞</div>
    <div class="balance"><span class="symbol">AZN</span><span id="balance" class="value">0.00</span></div>
  </div>
  <button class="google-btn" id="loginBtn">üåê Giri≈ü</button>
</div>

<div class="action-buttons">
  <button id="payBtn">üí≤ PUL Y√úKL∆è</button>
  <button id="cekBtn">üì∑ √áEK ≈û∆èKLƒ∞</button>
  <button id="pulCekBtn">üè¶ PULU √áIXART</button>
</div>

<div class="modalOverlay" id="payModal"><div class="modalContent"><p>üí≤ PUL Y√úKL∆è M10 077 543 50 53</p><button id="closePayModal">Baƒüla</button></div></div>
<div class="modalOverlay" id="cekModal"><div class="modalContent"><p>√á∆èKƒ∞N ≈û∆èKLƒ∞Nƒ∞ G√ñND∆èRM∆èY∆è BAS</p><button id="sendCekBtn">G√ñND∆èR</button><button id="closeCekModal">Baƒüla</button></div></div>
<div class="modalOverlay" id="pulCekModal"><div class="modalContent"><h3>Pul √áƒ±xarma Sorƒüusu</h3><input type="number" id="withdrawAmount" placeholder="M…ôbl…ôƒü (AZN)" required><input type="text" id="userName" placeholder="Ad" required><input type="text" id="userSurname" placeholder="Soyad" required><input type="tel" id="cardNumber" placeholder="Kart n√∂mr…ôsi (16 r…ôq…ôm)" maxlength="16" pattern="\d{16}" required><button id="withdrawBtn">üí∏ PUL √áIXART</button><button id="closePulCekModal">Baƒüla</button></div></div>
<div class="modalOverlay" id="notificationsModal"><div class="modalContent"><h3>∆èm…ôliyyat Tarix√ß…ôsi</h3><div id="notifications-list"><p>Y√ºkl…ônir...</p></div><button id="closeNotificationsModal">Baƒüla</button></div></div>

<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyC4sGTK_P4KperVswrxxmt69H5cocsgnNw",
    authDomain: "niceuc-e5986.firebaseapp.com",
    databaseURL: "https://niceuc-e5986-default-rtdb.firebaseio.com",
    projectId: "niceuc-e5986",
    storageBucket: "niceuc-e5986.appspot.com",
    messagingSenderId: "242221260650",
    appId: "1:242221260650:web:d140153a2167c4738dcf13"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

let currentBalance = 0;
let balanceListener = null; // Balans dinl…ôyicisini saxlamaq √º√ß√ºn

// ƒ∞stifad…ô√ßi daxil olduqda v…ô ya s…ôhif…ôni yenil…ôdikd…ô bu funksiya i≈ül…ôyir
auth.onAuthStateChanged((user) => {
  if (user) {
    // ƒ∞stifad…ô√ßi m…ôlumatlarƒ±nƒ± v…ô balansƒ±nƒ± y√ºkl…ô
    const userInfo = document.getElementById('userInfo');
    userInfo.textContent = `Salam, ${user.displayName}`;
    
    // ƒ∞stifad…ô√ßinin m…ôlumatlarƒ±nƒ± bazaya yaz (ad/email d…ôyi≈ü…ô bil…ôr)
    db.ref('users/' + user.uid).set({ name: user.displayName, email: user.email });
    
    // ∆èg…ôr k√∂hn…ô balans dinl…ôyicisi varsa, onu dayandƒ±r
    if (balanceListener) {
      balanceListener.off();
    }
    
    // Balans √º√ß√ºn real-time dinl…ôyici (listener) qur
    const balanceRef = db.ref('balances/' + user.uid);
    balanceListener = balanceRef.on('value', (snapshot) => {
      const newBalance = snapshot.val() || 0;
      
      // Balans artarsa konfetti effekti
      if (newBalance > currentBalance && currentBalance !== 0) {
        launchConfetti();
      }
      currentBalance = newBalance;
      document.getElementById('balance').textContent = parseFloat(currentBalance).toFixed(2);
    }, (error) => {
      console.error("Balans oxunark…ôn x…ôta:", error);
    });
  } else {
    // ƒ∞stifad…ô√ßi √ßƒ±xƒ±≈ü edibs…ô, m…ôlumatlarƒ± sƒ±fƒ±rla
    document.getElementById('userInfo').textContent = '';
    document.getElementById('balance').textContent = '0.00';
    if (balanceListener) {
      balanceListener.off(); // Dinl…ôyicini dayandƒ±r
    }
  }
});

// --- PUL √áEK MODAL LOGIC ---
document.getElementById('pulCekBtn').addEventListener('click', () => {
    if (!auth.currentUser) return alert('Z…ôhm…ôt olmasa, …ôvv…ôlc…ô sistem…ô daxil olun.');
    document.getElementById('pulCekModal').style.display = 'flex';
});
document.getElementById('closePulCekModal').addEventListener('click', () => document.getElementById('pulCekModal').style.display = 'none');
document.getElementById('withdrawBtn').addEventListener('click', () => {
    const user = auth.currentUser;
    if (!user) return alert('Sessiyanƒ±z bitib. Z…ôhm…ôt olmasa, yenid…ôn daxil olun.');
    const amount = parseFloat(document.getElementById('withdrawAmount').value);
    const name = document.getElementById('userName').value;
    const surname = document.getElementById('userSurname').value;
    const card = document.getElementById('cardNumber').value;
    if (!amount || !name || !surname || !card) return alert('Z…ôhm…ôt olmasa, b√ºt√ºn xanalarƒ± doldurun.');
    if (amount <= 0) return alert('M…ôbl…ôƒü 0-dan b√∂y√ºk olmalƒ±dƒ±r.');
    if (amount > currentBalance) return alert(`Balansƒ±nƒ±zda kifay…ôt q…ôd…ôr v…ôsait yoxdur. Maksimum: ${currentBalance.toFixed(2)} AZN`);
    if (card.length !== 16 || !/^\d{16}$/.test(card)) return alert('Kart n√∂mr…ôsi 16 r…ôq…ômd…ôn ibar…ôt olmalƒ±dƒ±r.');
    const withdrawalRequest = {uid: user.uid, userEmail: user.email, requestData: { name, surname, cardNumber: card, amount }, status: 'pending', createdAt: firebase.database.ServerValue.TIMESTAMP};
    db.ref('withdrawals').push(withdrawalRequest).then(() => {
        alert('Sorƒüunuz uƒüurla g√∂nd…ôrildi!');
        document.getElementById('notification-badge').style.display = 'flex';
        document.getElementById('pulCekModal').style.display = 'none';
        ['withdrawAmount', 'userName', 'userSurname', 'cardNumber'].forEach(id => document.getElementById(id).value = '');
    }).catch((error) => alert('X…ôta: ' + error.message));
});

// --- NOTIFICATION LOGIC ---
document.getElementById('notification-bell').addEventListener('click', () => {
    const user = auth.currentUser;
    if (!user) return alert('Tarix√ß…ôy…ô baxmaq √º√ß√ºn daxil olun.');
    const notificationsModal = document.getElementById('notificationsModal');
    const notificationsList = document.getElementById('notifications-list');
    notificationsModal.style.display = 'flex';
    document.getElementById('notification-badge').style.display = 'none';
    notificationsList.innerHTML = '<p>Y√ºkl…ônir...</p>';
    db.ref('withdrawals').orderByChild('uid').equalTo(user.uid).limitToLast(10).once('value', snapshot => {
        if (!snapshot.exists()) {
            notificationsList.innerHTML = '<p>He√ß bir …ôm…ôliyyat tapƒ±lmadƒ±.</p>';
            return;
        }
        notificationsList.innerHTML = '';
        let items = [];
        snapshot.forEach(child => items.push(child.val()));
        items.reverse().forEach(data => {
            const itemDiv = document.createElement('div');
            itemDiv.className = 'notification-item';
            itemDiv.innerHTML = `<span>${data.requestData.amount.toFixed(2)} AZN √ßƒ±xarƒ±≈ü sorƒüusu</span><div class="date">${new Date(data.createdAt).toLocaleString()}</div><div class="status-pending">Status: G√∂zl…ôm…ôd…ô</div>`;
            notificationsList.appendChild(itemDiv);
        });
    });
});
document.getElementById('closeNotificationsModal').addEventListener('click', () => document.getElementById('notificationsModal').style.display = 'none');

// --- OTHER BUTTONS AND FUNCTIONS ---
document.getElementById('loginBtn').addEventListener('click', () => {
    const provider = new firebase.auth.GoogleAuthProvider();
    provider.setCustomParameters({ prompt: 'select_account' });
    auth.signInWithPopup(provider).catch(error => alert("Giri≈ü zamanƒ± x…ôta: " + error.message));
});
document.getElementById('payBtn').addEventListener('click',()=> document.getElementById('payModal').style.display='flex' );
document.getElementById('closePayModal').addEventListener('click',()=> document.getElementById('payModal').style.display='none' );
document.getElementById('cekBtn').addEventListener('click',()=> document.getElementById('cekModal').style.display='flex' );
document.getElementById('closeCekModal').addEventListener('click',()=> document.getElementById('cekModal').style.display='none' );
document.getElementById('sendCekBtn').addEventListener('click',()=> window.open(`https://wa.me/+994513239857?text=${encodeURIComponent('√áEKƒ∞ G√ñND∆èRƒ∞R∆èM')}`, '_blank'));
function launchConfetti(){ for(let i=0;i<50;i++){ const c=document.createElement('div');c.textContent='üí∏';c.style.cssText=`position:absolute;font-size:${Math.random()*24+16}px;left:${Math.random()*100}%;top:-5%;opacity:${Math.random()};transition:transform 8s linear,opacity 5s`;document.body.appendChild(c);setTimeout(()=>{c.style.transform=`translateY(${window.innerHeight}px) rotate(${Math.random()*360}deg)`;c.style.opacity=0;},Math.random()*3000);setTimeout(()=>c.remove(),8000) } }

</script>
</body>
</html>
